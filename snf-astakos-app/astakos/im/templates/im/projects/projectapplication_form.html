{% extends "im/account_base.html" %}

{% load filters %}
{% load astakos_tags %}
{% block headjs %}
	{{ block.super }}	 
	<script src="{{ IM_STATIC_URL }}js/quotas.js"></script>	
{% endblock %}	

{% block page.body %}

 
{% with resource_catalog|populated_resource_catalog as resource_catalog %}
{% if show_form %}
<form action="?verify=1#top" method="post" class="withlabels quotas-form" id="group_create_form">{% csrf_token %}

    <fieldset class="with-info" id="top">
    	<legend>
    		1. CREATE GROUP
			<span class="info"> 
		    	<em>more info</em>
		    	<span>Fill in the required fields to create a group. Group details will be visible to the users of the group.</span>
	    	</span>    		
    	</legend>
        
        {% include "im/form_render.html" %}
        
        {% for g, resources in resource_catalog.get_groups_resources %}
	    	{% for rname in resources.keys %}
	    	    {% with object|resource_grants|lookup:rname as value %}
	    	        <input type="hidden" id="{{'id_'|add:rname|add:'_uplimit'}}" name="{{rname|add:'_uplimit'}}" autocomplete="off" {% if value %}value="{{value}}"{% endif %}">
                {% endwith %}
            {% endfor %}
        {% endfor %}
    </fieldset>
    
    <fieldset id="icons">
    	<legend>
    		2. ADD RESOURCES
    		<span class="info"> 
		    	<em>more info</em>
		    	<span>You need to specify at least one resource</span>
	    	</span>    
    	</legend>
    	<ul class="clearfix">
    	    {% with object|resource_groups as groups %}
            {% for g, group_info in resource_catalog.groups.items %}
                {% if g %}
	    		<li>
	    		    <a href="#{{ g }}" id="{{'group_'|add:g}}" {% if g in groups %}class="selected"{% endif %}><img src="/static/im/images/create-{{ g }}.png" alt="vm"/></a>
	    			<input type="hidden" name="proxy_{{ 'is_selected_'|add:g }}"  id="proxy_{{ 'id_is_selected_'|add:g }}" {% if g in groups %}value="1"{% else %}value="0"{% endif %}>
	    			<input type="hidden" name="{{ 'is_selected_'|add:g }}"  id="{{ 'id_is_selected_'|add:g }}" {% if g in groups %}value="1"{% else %}value="0"{% endif %}>
	                <p class="msg">{{ group_info.help_text }}</p>
	    		</li>
	    		{% endif %}
            {% endfor %}
            {% endwith %}
    	</ul>
    	
    </fieldset>
   
    <div class="visible">
    	
    </div>
    <div class="not-visible">
    	{% for gname, resources in resource_catalog.get_groups_resources %}
    	    <div class="group {{'group_'|add:gname}}" id="{{ gname }}">
	    		<a href="#icons" class="delete">X remove resource</a>	
	    		{% for rname, rdata in resources.items %}
	    		<fieldset class="quota">
			    	
			    	<legend>
			    		{% if rdata.is_abbreviation %}
			    			{{ rdata.verbose_name|upper }}
			    		{% else %}
			    			{{ rdata.verbose_name|capfirst }}
			    		{% endif %}
			    		<span class="info"> 
					    	<em>more info</em>
					    	<span>{{ rdata.help_text }}</span>
				    	</span>  
			    	</legend>
			    	<div class="form-row">
			    		<p class="clearfix">
			    			<label for="{{'id_'|add:rname|add:'_uplimit'}}_proxy" >
								Amount to grant per user
							</label>
			    			<input 	type="text" 
			       						id="{{'id_'|add:rname|add:'_uplimit'}}_proxy" 
			       						name="{{rname|add:'_uplimit'}}_proxy" 
			       						placeholder="{{ rdata.placeholder}} " 
			       						{% if rdata.unit == 'bytes' %} 
										 	class="dehumanize"
										{% endif  %}
										{% if request.POST %}
											{% with rname|add:'_uplimit' as input_value %}
											value = "{{ request.POST|lookup:input_value }}"
											{% endwith %}
										{% else %}
											value = "{% get_grant_value rname form %}"
										{% endif %}
			       						/> 
			       			<span class="extra-img">&nbsp;</span>
			         		<span class="info"><em>more info</em><span>{{ rdata.help_text_input_each }}</span></span>
			         		<p class="error-msg">Invalid format</p>
			    		</p>
			    		<p class="msg"></p>
			    	</div>
				</fieldset>	
				{% endfor %}
	    	</div>
	    	 
	    {% endfor %}
    </div>
    
	<input type="hidden" name="user"  id="id_user" value="{{user.id}}">  
	<div class="form-row submit">
   		<input type="submit" value="CONTINUE" class="submit altcol" autocomplete="off">
	</div>
</form>
{% else %}
    {% include "im/projects/projectapplication_form_summary.html" %}
{% endif %}

<script>
	
</script>	 

{% endwith %}
{% endblock %}