{% extends "im/account_base.html" %}

{% block page.body %}
<div class="maincol {% block innerpage.class %}{% endblock %}">
        <table class="zebra-striped id-sorted">
              <tr>
                <th>Name: {{object.name}}</th>
              </tr>
              <tr>
                <th>Type: {{object.kind}}</th>
              </tr>
              <tr>
                <th>Issue date: {{object.issue_date}}</th>
              </tr>
              <tr>
                <th>Expiration date: {{object.expiration_date}}</th>
              </tr>
              <tr>
                <th>Moderation: {% if object.moderation_enabled%}Yes{% else %}No{% endif %}</th>
              </tr>
              <tr>
                <th>Owner: {% for o in object.owner.all %}
                                {% if user == o %}
                                    Me!
                                {% else%}
                                    {{o.realname}} ({{o.email}})
                                
                                {% endif %}
                            {% endfor %}
                </th>
              </tr>
        </table>
    <div class="section">
        <h2>Members:</h2>
        {% if object.members %}
          <table class="zebra-striped id-sorted">
            <thead>
              <tr>
                <th>Email</th>
                <th>Realname</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody>
            {% for m in object.membership_set.all %}
              <tr>
                <td>{{m.person.email}}</td>
                <td>{{m.person.realname}}</td>
                {% if m.person in m.group.owner.all %}
                <td>Owner</td>
                {% else %}
                    {% if m.is_approved %}
                    <td>Approved</td>
                    {% else %}
                    <td>Pending</td>
                        {% if user in m.group.owner.all %}
                            <td><a href="{% url approve_member m.id %}">Approve</a></td>
                            <td><a href="{% url disapprove_member m.id %}">Disapprove</a></td>
                        {% endif %}
                    {% endif %}
                {% endif %}
              </tr>
            {% endfor %}
            </tbody>
        </table>
        {% else %}
            <p>No members yet!</p>
        {% endif %}
    </div>
    <div class="section">
        <h2>Policies:</h2>
        {% if quota %}
          <table class="zebra-striped id-sorted">
            <thead>
              <tr>
                <th>Resource</th>
                <th>Limit</th>
              </tr>
            </thead>
            <tbody>
            {% for q in quota %}
                <tr>
                    <td>{{q.resource.name}}</td>
                    <td>{{q.limit}}</td>
                  </tr>
            {% endfor %}
            </tbody>
        </table>
        {% else %}
            <p>No policies</p>
        {% endif %}
    </div>
    {% if more_policies %}
    <div class="rightcol">
        <form action="{% url group_policies_add object.id %}" method="post" class="innerlabels signup">{% csrf_token %}
            <h2><span>NEW POLICY</span></h2>
                {% include "im/form_render.html" %}
                <div class="form-row submit">
                    <input type="submit" class="submit altcol" value="+" />
                </div>
        </form>
    </div>
    {% endif %}
</div>
{% endblock %}
