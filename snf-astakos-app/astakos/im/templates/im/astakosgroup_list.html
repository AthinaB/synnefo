{% extends "im/account_base.html" %}

{% load filters %}

{% block page.body %}
<div class="maincol {% block innerpage.class %}{% endblock %}">
    <div class="projects">
	    <h2>GROUPS</h2>
	    {% if form %}
		    <p>You can search for a group by name</p>
		    <form action="{% url group_search %}" method="post" class="withlabels signup">{% csrf_token %}
		            {% include "im/form_render.html" %}
		            <div class="form-row submit">
		                <input type="submit" class="submit altcol" value="SEARCH" />
		            </div>
		    </form>
		     
		    <form action="{% url group_all %}" method="post" class="link-like alone">{% csrf_token %}
		        <div class="form-row submit">
		            <input type="submit" class="submit altcol" value="Show all groups" />
		        </div>
		    </form>
	    {% else %}
    
		<p>Okeanos grants resources according to activities organized by groups.
		   Join or create a group to get access to more resources.
		   <a href="{% url group_search %}">Join an existing one</a>
		   or
		   <!--<a href="{% url group_create_list %}">Create a new group</a>-->
		   <a href="{% url group_add 'default' %}">create a new group</a>.
		</p>
		
		<div class="widjets"> 
			<!--<a href="#" class="widjet-x" title="remove boxes">X</a>-->
			<ul class="clearfix">	
				<li class="create">
					<div>
						<div class="wrap">
							<h2>WELCOME!</h2>
							<p><a href="{% url group_add 'course' %}"><img alt="THINK ABOUT IT" src="/static/im/images/create.png"></a></p>
							<p class="txt">Connect with a world of people who share your passions.<br>With millions of groups at your fingertips, it's easy to find the group that's best for you -- no matter your interest.</p>
							<p><a href="{% url group_add 'default' %}">create a group ></a></p>
							<!--<p class="btn"><a href="{% url group_create_list %}" class="submit">CREATE</a></p>-->
						</div>
					</div>
				</li>
				<li class="join">
					<div>
						<div class="wrap">
							<h2>ALREADY AWARE?</h2>
							<p><a href="{% url group_search %}"><img alt="THINK ABOUT IT" src="/static/im/images/join.png"></a></p>
							<p class="txt">Well, this is the place to start!<br>sdofuisd ofuaofi usdiof uiofu osifuaoi ufisdfiousf oiusd<br></p>
							
							<p><a href="{% url group_search %}">join a group ></a></p>
						</div>
					</div>
				</li>
			</ul>
		</div>
        
    {% endif %}
    {% with page_obj.object_list as object_list %}
    <!-- Search group -->
    {% if object_list %}
        <div class="full-dotted">
        	<form method="GET" class="minimal" action="#searchResults"> 
				<div class="form-row">
					<select name="sorting" onchange="this.form.submit();" class="dropkicked">
					    <option value="">Sort by</option>
					    <option value="groupname" {% if sorting == 'groupname' %}selected{% endif %}>Name</option>
			            <!--option value="kindname" {% if sorting == 'kindname' %}selected{% endif %}>Type</option-->			
			            <option value="issue_date" {% if sorting == 'issue_date' %}selected{% endif %}>Issue date</option>			
			            <option value="expiration_date" {% if sorting == 'expiration_date' %}selected{% endif %}>Expiration Date</option>
			            <option value="approved_members_num" {% if sorting == 'approved_members_num' %}selected{% endif %}>Participants</option> 
					</select>
					<input type="hidden" name="q" value="{{q}}"/>
				</div>
			</form>
            <table class="alt-style complex" id="searchResults">
                <caption>
                    SEARCH RESULTS
                </caption>
                <thead>
                  <tr>
                    <th>Name</th>
                    <!--<th>Type</th>-->
                    <th>Issued</th>
                    <th>Expires</th>
                     
                    <th>Enrolled</th>
                   
                     
                    <th>Status</th>
                    <th>&nbsp;</th>
                  
                  </tr>
                </thead>
                <tbody>
                  {% for o in object_list %}
                   <tr class="{% cycle 'tr1' 'tr2' %}">
	                    <td><a href="{% url group_detail o.id %}" title="visit group page">{{o.groupname|rcut:"/"}}</a></td>
	                    <!--td>{{o.kindname|capfirst}}</td-->
	                    <td>{{o.issue_date|date:"d/m/Y"}}</td>
	                    <td>{{o.expiration_date|date:"d/m/Y"}}</td>
	                    <td>{{o.approved_members_num}}</td>
	                    
	                    <td>
	                    	<div class="msg-wrap">
	                    		 
		                    {% if o.is_member %}
		                        {% if o.membership_approval_date %}
		    
		                        
			                       	{% if not o.is_owner %}
			                            Registered
			                            <form action="{% url group_leave o.id %}" method="post" class="link-like">{% csrf_token %}
			                                 <input type="submit"  value="x leave group" class="leave"/>
			                            </form>
			                            <div class="dialog">
					                		Are you sure you what to leave this group?<br>
					                		Name: <a  href="{% url group_detail o.id %}" title="visit group page">{{o.groupname|rcut:"/" }}</a><br>
					                		{% if o.desc %}Description:{{o.desc|truncatewords:30}}{% endif %}<br><br>
					                		
					                		<a href="#" class="yes submit">Yes</a>&nbsp;&nbsp;&nbsp;<a href="#" class="no submit">No</a>
					                	</div>
			                        {% else %}
			                        	Owner
			                        {% endif %}
		                        
		                            
		
		                        {% else %}
		                            Pending
		                        {% endif %}
		                    {% else %}
		                            Not member 
		                                <form action="{% url group_join o.id %}" method="post" class="link-like">{% csrf_token %}
		                                    <input type="submit"   value="+ join group" class="join_group join" />
		                                </form>
		                                <div class="dialog">
					                		Are you sure you what to join this group?<br>
					                		Name: <a  href="{% url group_detail o.id %}" title="visit group page">{{o.groupname|rcut:"/" }}</a><br>
					                		{% if o.desc %}Description:{{o.desc|truncatewords:30}}{% endif %}<br><br>
					                		
					                		<a href="#" class="yes submit">Yes</a>&nbsp;&nbsp;&nbsp;<a href="#" class="no submit">No</a>
					                	</div>
		                            
		                    {% endif %}
	                    	</div>
	                    </td>
	                    <td><a href="#" class="more-info" title="more info">+ more info</a></td>
                  </tr>
                  <tr class="{% cycle 'tmore1' 'tmore2' %}" style="display:none">
                    <td colspan="7" class="info-td">
                        <div>
                            <p>{{o.desc}}</p>
                            <p>{% if o.homepage%}
                                Group's home page: <a target="_blank" href="{{ o.homepage }}">{{ o.homepage }}</a>
                            
                            {% endif %}
                            </p>
                        </div>	
                    </td>
                  </tr>
                  {% endfor %}
                </tbody>
            </table>
           
        </div>
        
     
	    <div class="pagination">
			<p class="next-prev">
		        {% if page_obj.has_previous %}
	                <a href="?page={{ page_obj.previous_page_number }}{% if q %}&q={{q}}{% endif %}{% if sorting %}&sorting={{sorting}}{% endif %}">previous</a>
	            {% endif %}
	            {% if page_obj.has_next %}
	                <a href="?page={{ page_obj.next_page_number }}{% if q %}&q={{q}}{% endif %}{% if sorting %}&sorting={{sorting}}{% endif %}">next</a>
	            {% endif %}
	    	</p>
			<p class="nums">
				<span class="current">
	                Page {{ page_obj.number }} of {{ paginator.num_pages }}
	            </span>
			</p>
	   </div>
      <!-- Group listing -->
       {% else %}
       		{% if not form %}
            {% with page|concat:sorting as args %}
            {% with q|paginate:args as page_obj %}
        	 
	      	    <div >
					<form method="GET" class="minimal" action="#allGroups" id="mygroups">
						<div class="form-row">
						    <select name="sorting"  class="dropkicked">
							    <option value="">Sort by</option>
							    <option value="groupname" {% if sorting == 'groupname' %}selected{% endif %}>Name</option>
					            <!--<option value="kindname" {% if sorting == 'kindname' %}selected{% endif %}>Type</option>-->			
					            <option value="issue_date" {% if sorting == 'issue_date' %}selected{% endif %}>Issue date</option>			
					            <option value="expiration_date" {% if sorting == 'expiration_date' %}selected{% endif %}>Expiration Date</option>
					            <option value="approved_members_num" {% if sorting == 'approved_members_num' %}selected{% endif %}>Participants</option>
					            <option value="is_enabled" {% if sorting == 'is_enabled' %}selected{% endif %}>Status</option>
					            <option value="moderation_enabled" {% if sorting == 'moderation_enabled' %}selected{% endif %}>Moderation</option>		
							</select>
						</div>
					</form>
					<table class="alt-style complex" id="allGroups">
			            <caption>MY GROUPS</caption>
			            <thead>
			              <tr>
			                <th>Name</th>
			                <!--th>Type</th-->
			                <th>Issued</th>
			                <th>Expires</th>
			                <th>Enrolled</th>
			                <th>Status</th>
			                <th class="centered">Moderated</th>
			                <th>&nbsp;</th>
			                
			              </tr>
			            </thead>
			            <tbody>
			              {% for o in page_obj.object_list %}
			              <tr class="{% cycle 'tr1' 'tr2' %}">
			                <td><a  href="{% url group_detail o.id %}" title="visit group page">{{o.groupname|rcut:"/" }}</a></td>
			                <!--td>{{o.kindname|capfirst}}</td-->
			                <td>{{o.issue_date|date:"d/m/Y"}}</td>
			                <td>{{o.expiration_date|date:"d/m/Y"}}</td>
			                <td>{{ o.approved_members_num }}</td>
			                <td>
			                	<div class="msg-wrap">
			                 	{% if user.email = o.groupowner %}
			                		{% if o.is_enabled %}
			                			Owner
			                		{% else %}
			                			Pending
			                		{% endif %}
			                	{% else %}
			                		{% if o.is_enabled %}
			                			{% if o.membership_status %}
						                    Registered
					                    	<form action="{% url group_leave o.id %}" method="post" class="link-like">{% csrf_token %}
					                             <input type="submit"  value="x leave" class="leave" />
					                        </form>	
					                        <div class="dialog">
						                		Are you sure you what to leave this group?<br>
						                		Name: <a  href="{% url group_detail o.id %}" title="visit group page">{{o.groupname|rcut:"/" }}</a><br>
						                		{% if o.desc %}Description:{{o.desc|truncatewords:30}}{% endif %}<br><br>
						                		
						                		<a href="#" class="yes submit">Yes</a>&nbsp;&nbsp;&nbsp;<a href="#" class="no submit">No</a>
						                	</div>
						                {% else %}
						                    Pending
						                {% endif %}
			                		{% else %}
			                			-
			                		{% endif %}
			                	{% endif %}
			                	
			                	</div>
			                </td>
			                <td class="centered">{% if o.moderation_enabled%}Yes{% else %}No{% endif %}</td>
			                <td><a href="#" class="more-info" title="more info">+ more info </a></td>
			              </tr>
			              <tr class="{% cycle 'tmore1' 'tmore2' %}" style="display:none">
			                <td colspan="8" class="info-td">
			                	<div>
			                		<p>{{o.desc}}</p>
					                <p>{% if o.homepage%}
							 			Group's home page: <a href="{{ o.homepage }}">{{ o.homepage }}</a>
							 		{% endif %}
							 		</p>
			                	</div>	
			                </td>
			              </tr>
			              {% endfor %}
			            </tbody>
			        </table>
				</div>
				<div class="pagination">
					<p class="next-prev">
				        {% if page_obj.has_previous %}
                            <a href="?page={{ page_obj.previous_page_number }}{% if sorting %}&sorting={{ sorting }}{% endif%}#allGroups">previous</a>
                        {% endif %}
			            {% if page_obj.has_next %}
                            <a href="?page={{ page_obj.next_page_number }}{% if sorting %}&sorting={{ sorting }}{% endif%}#allGroups">next</a>
                        {% endif %}
			    	</p>
					<p class="nums">
						<span class="current">
                            Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}
                        </span>
					</p>
			   </div>
		 
        	{% endwith %} 
	      	{% endwith %} 
	      	{% endif %}
	      	{% if form %}
	            {% if q %}
	                <h2>No groups found!</h2>
	            {% endif %}
	        {% endif %}
      {% endif %}
    {% endwith %}
</div>
</div>  
{% endblock %}
