<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <title>Σύννεφο -- Εφαρμογή HelpDesk</title>
    <script src="/static/jquery.tools.min.js"></script>
    <script src="/static/jquery.cookie.js"></script>
    
    <style>
        .center {text-align: center;}
        .header {height: 10%;}
        .frame  {width: 100%; height: 90%}
    </style>

    <script type="text/javascript">

        jQuery.fn.countdown = function(options) {

            if(!options) options = '()';
            if(jQuery(this).length == 0) return false;
            var obj = this;

            if(options.seconds < 0 || options.seconds == 'undefined') {
                if(options.callback) eval(options.callback);
                return null;
            }

            window.setTimeout(
                function() {
                    jQuery(obj).html(String(options.seconds));
                    --options.seconds;
                    jQuery(obj).countdown(options);
                }
                , 1000
            );

            return this;
        }

        jQuery.fn.countdown.stop = function() {
	        window.clearTimeout(setTimeout("0")-1);
        }

        $(document).ready(function() {

            $("#username").change(function() {
                if ($("#username").val() != '') {
                    $("#go").removeAttr("disabled");
                } else {
                    $("#go").attr('disabled', 'disabled');
                }
            });

            $("#go").click(function() {

                var val = $("#username").val();
                $.ajax({
                    url:  '/helpdesk/token',
                    data: {user_id: $("#username").val()},
                    type: 'GET',
                    dataType: 'json',
                    success: function(data) {
                        $('#remtime').countdown({seconds: 40,callback: 'alert(foo)'});
                        $.cookie('X-Auth-Tmp-Token', data.token, {secure: true});
                        $("#content").attr("src", "/");
                    },
                    error : function(xhr, textStatus, errorThrown) {
                        alert(errorThrown)
                    }
                });
            });
        });

    </script>
</head>

<body>

<div id="header" class="center">
    Επιλέξτε το όνομα του χρήστη:
    <select id="username">
            <option value="">--Επιλογή--</option>
         {% for user in users %}
             <option value="{{ user.id }}">{{ user.name }}</option>
         {% endfor %}
    </select>
    <input id="go" type="button" value="Go" disabled="true"/>
    <span id="remtime"/>
</div>

<iframe id="content" src="/" class="center frame">
    <p>
        Your browser does not support iframes.
        Use a current millenium browser.
    </p>
</iframe>

</body>
</html>