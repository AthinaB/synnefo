{% load i18n %}
<!DOCTYPE html>
<head>
	<title>{{ project }}</title>
	<!-- include the Tools -->
    <!-- jquery tools minified for deployment-->
    <script src="static/jquery.tools.min.js"></script>
    
	<!-- jquery tools source for JS debugging -->
    <!--
    <script src="http://flowplayer.org/tools/download/1.2.5/jquery-1.4.2.js"></script>   
	<script src="http://flowplayer.org/tools/download/1.2.5/tabs/tabs.js"></script>
	<script src="http://flowplayer.org/tools/download/1.2.5/scrollable/scrollable.js"></script>
	<script src="http://flowplayer.org/tools/download/1.2.5/overlay/overlay.js"></script>
	<script src="http://flowplayer.org/tools/download/1.2.5/rangeinput/rangeinput.js"></script>
	<script src="http://flowplayer.org/tools/download/1.2.5/toolbox/toolbox.expose.js"></script>
    -->
    
    <script src="static/jquery.cookie.js"></script>
    <script src="static/jQueryRotate.js"></script>
    <script src="static/jquery.dataTables.min.js"></script>
    <script src="static/synnefo.js"></script>
	<link rel="stylesheet" type="text/css" href="static/main.css"/>	
    <script>
        // timeout value from settings.py
        var TIMEOUT = {{timeout}};
        var UPDATE_INTERVAL = {{5000}};
        var STATUS_MESSAGES = {
            'BUILD'     : '{% trans "Building" %}',
            'REBOOT'     : '{% trans "Rebooting" %}',            
            'STOPPED'   : '{% trans "Stopped" %}',
            'ACTIVE'   : '{% trans "Running" %}',
            'ERROR'   : '{% trans "Error" %}'
        };
        
        var ERRORS = {
            // error message header
            'HEADER' : '{% trans "Error!" %}',
            // default
            'DEFAULT' : '{% trans "Could not contact the service. Please check your network connectivity and try again." %}',
            // bad request
            '400' : '{% trans "Malformed request." %}',
            // not found
            '404' : '{% trans "Your request has failed. Resource not found." %}',
            // internal server error
            '500' : '{% trans "There has been an Internal Error. Our administrators have been notified." %}',
            // service unavailable
            '501' : '{% trans "This server has not been implemented yet." %}',
            // service unavailable
            '503' : '{% trans "This service is unavailable right now, please try again later." %}',
            // no images found
            'NO_IMAGES' : '{% trans "Cannot show the Create machine wizard: No images found." %}',
            // no flavors found
            'NO_FLAVORS' : '{% trans "Cannot show the Create machine wizard: No machine configurations found." %}'
        };
        
        var SUCCESS = {
            'HEADER' : '{% trans "Success!" %}',
            'DEFAULT' : '{% trans "Your request has been succefully executed." %}',
            'CREATE_VM_SUCCESS' : '{% trans "Success!" %}',
            'CREATE_VM_SUCCESS_ONE' : '{% trans "Your machine is now being built." %}',
            'CREATE_VM_SUCCESS_TWO' : '{% trans "Please write down the following password:" %}',
            'CREATE_VM_SUCCESS_THREE' : '{% trans "Do not lose this! You will need it to connect to your machine, once it is ready." %}'
        };
        
        // ajax error checking  
        function ajax_error(status, serverID, action, responseText) {
            var serverName = '';
            
            if (serverID != undefined) {
                serverName = $("#"+serverID).parent().parent().find("span.name").text();
            }
            
            // prepare the error message
            $("#error-success h3").text(ERRORS['HEADER']);
            if (responseText != undefined){
                var errors = parse_error(responseText);
                if (serverName){
                    serverName="<p><strong>Server:</strong> " + serverName + "</p>";
                }
                $("#error-success div").html("<p>"+(errors[0].message || ERRORS[errors[0].code]) +"</p>"+serverName +"<p><strong>Action:</strong> " + action + "</p><p><strong>Code</strong>: " + errors[0].code + "</p><p><strong>Details:</strong> " + errors[0].details +"</p>");
            } else if (ERRORS[status] != undefined) {
                if (serverID == undefined){
                    $("#error-success p").text(ERRORS[status]);
                } else {
                    $("#error-success p").html("<b>" + serverName + "</b>" + ": " + ERRORS[status]);
                }
            } else {
                $("#error-success p").text(ERRORS['DEFAULT']);   
            }
            
            // bring up error notification
            var triggers = $("a#notification").overlay({
                // some mask tweaks suitable for modal dialogs
                mask: {
                    color: '#ebecff',
                    opacity: '0.9'
                },
                top: 'center',
                closeOnClick: false,
                oneInstance: false,
                load: false,
                onClose: function(){
                    // With partial refresh working properly,
                    // it is no longer necessary to refresh the whole page
                    // choose_view();
                }
            });
            $("a#notification").data('overlay').load();
            return false;
        }
        
        // ajax success checking
        function ajax_success(status, password) {
            // prepare the error message
            // bring up success notification
            if (status != undefined && SUCCESS[status]) {
                if (password != undefined && status == "CREATE_VM_SUCCESS") {
                    $("#error-success h3").text(SUCCESS[status]);
                    var CREATE_VM_SUCCESS_MSG = SUCCESS["CREATE_VM_SUCCESS_ONE"] + '<br />'
                        + SUCCESS["CREATE_VM_SUCCESS_TWO"] + '<br /><br />' + '<b>' + password + '</b>'
                        + '<br /><br />' + SUCCESS["CREATE_VM_SUCCESS_THREE"] ;
                    $("#error-success div").html("<p>" + CREATE_VM_SUCCESS_MSG + "</p>");             
                } else {
                    $("#error-success h3").text(SUCCESS['HEADER']);
                    $("#error-success div").text("<p>" + SUCCESS[status] + "</p>");             
                }
            } else {
                $("#error-success h3").text(SUCCESS['HEADER']);
                $("#error-success div").html("<p>" + SUCCESS['DEFAULT'] + "</p>");             

            }


            var triggers = $("a#notification").overlay({
                // some mask tweaks suitable for modal dialogs
                mask: {
                    color: '#ebecff',
                    opacity: '0.9'
                },
                top: 'center',
                closeOnClick: false,
                oneInstance: false,
                load: false,
                onClose: function(){
                    // With partial refresh working properly,
                    // it is no longer necessary to refresh the whole page
                    // choose_view();
                }
            });
            $("a#notification").data('overlay').load();
            return false;
        }
    </script>
</head>
<body>
    <div id="wrapper">
        <div id='user'>
            <a href="#">{% trans "username" %}</a> &nbsp;|&nbsp; <a href="#">{% trans "settings" %}</a>
            {% get_available_languages as LANGUAGES %}
            {% for lang in LANGUAGES %}
                &nbsp;|&nbsp;
                <a {% if current_lang == lang.0 %}class="current_lang" {% else %}  href="/lang/?l={{lang.0}}" {% endif %}>{{lang.0}}</a> 
            {% endfor %}
        </div>
        <div id='header'>
            <a href="/" class="logo">
                <img src="static/nefo.png" alt="+nefo"/>
            </a>
            <div class='fatborder'></div>
        </div>
        <!-- tabs -->
        <ul class="css-tabs">
	        <li><a href="machines" title="{% trans "manage your virtual machines" %}" class="primary" id="machines">
                {% trans "machines" %}</a></li>
	        <li><a href="disks" title="{% trans "manage your storage volumes" %}" class="primary" id="disks">
                {% trans "disks" %}</a></li>
	        <li><a href="images" title="{% trans "manage boot images" %}" class="primary" id="images">
                {% trans "images" %}</a></li>
	        <li><a href="networks" title="{% trans "configure networking" %}" class="primary" id="networks">
                {% trans "networks" %}</a></li>
            <li><a href="files" title="{% trans "your files" %}" class="secondary" id="files">
                {% trans "files" %}</a></li>
	        <li><a href="desktops" title="{% trans "your desktops" %}" class="secondary" id="desktops">
                {% trans "desktops" %}</a></li>
	        <li><a href="apps" title="{% trans "your apps" %}" class="secondary" id="apps">
                {% trans "apps" %}</a></li>
        </ul>
        <div class="more-tabs"><img src="static/arrow.png" id="arrow"></img></div>
        <div class="css-panes">
	        <div id="machines-pane" class="pane" style="display:block">{% include "machines.html" %}</div>
	        <div id="disks-pane" class="pane"></div>
	        <div id="images-pane" class="pane"></div>
	        <div id="networks-pane" class="pane"></div>
            <div id="files-pane" class="pane"></div>
	        <div id="desktops-pane" class="pane"></div>
	        <div id="apps-pane" class="pane"></div>
        </div>
    </div>
    <!-- activate tabs with JavaScript -->
    <script>
		$(function() {
		    $('ul.css-tabs li').hover(function(){
			    $(this).find('a:not(.current)').animate({top:'0px'},{queue:false,duration:150});
            }, function(){
                $('ul.css-tabs li a:not(.current)').animate({top:'9px'},{queue:false,duration:150});
		    });
		});
		
        $(function() {
	        $("ul.css-tabs").tabs("div.css-panes div.pane", {	
		        onBeforeClick: function(event, i) {
                    $('ul.css-tabs li a').animate({top:'9px'},{queue:false,duration:150});
			        // get the pane to be opened
			        var pane = this.getPanes().eq(i);
                    pane.text('');
			        // load it with a page specified in the tab's href attribute
			        pane.load(this.getTabs().eq(i).attr("href"),function(){if (!i) {choose_view()}});
		        }
	        });
        });

        // toggle main menu
        $("#arrow").click(function(event){
        	toggleMenu();
        });    
        
    </script>
</body>
</html>

